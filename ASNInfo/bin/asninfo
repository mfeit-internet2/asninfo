#!/bin/sh -e
#
# Run a Python script using the system's Python and dump anything sent
# to stderr to syslog on failure.
#

WHOAMI=$(basename "$0")
WHEREAMI=$(dirname "$0")

TMPBASE="${TMPDIR:=/tmp}/${WHOAMI}.$$"

SCRIPT="${WHEREAMI}/${WHOAMI}-wrapped"
STDERR="${TMPBASE}.stderr"

STATUS=0
"${SCRIPT}" "$@" 2> "${STDERR}" || STATUS=$?

if [ "${STATUS}" -ne 0 ]
then
    logger "Failure running ${SCRIPT}:"
    [ -s "${STDERR}" ] \
	&& logger < "${STDERR}" \
	|| logger "(Nothing on stderr)"
fi

exit "${STATUS}"
